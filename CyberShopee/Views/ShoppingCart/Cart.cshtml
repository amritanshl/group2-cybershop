@model CyberShopee.ViewModels.Cart.CartViewModel
@{
    // Resolve the wwwroot file to a proper web URL (handles virtual directories and spaces)
    var cartBg = Url.Content("/images/shopping%20cart.png");
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Shopping Cart</title>

    <style>
        /* Theme font (Razor-safe) */
        @@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');

        :root{
            --nav-left:#0C0B17;
            --nav-mid:#1B1538;
            --nav-right:#3C2E8F;
            --nav-line:#6F63D6;

            --ink-100:#EDEBFF;
            --ink-300:#C9C6F5;
            --ink-500:#9CA3C7;
            --ink-700:#DDE1FF;

            --card-bg:rgba(20,18,40,0.65);
            --card-stroke:rgba(111,99,214,0.35);

            --cta-1:#6F63D6;
            --cta-2:#4C3FBA;

            --shadow-1:0 12px 28px rgba(0,0,0,.35);
            --shadow-1-hover:0 18px 36px rgba(0,0,0,.45);
            --border-lite:#C8C6FF;
        }

        *{box-sizing:border-box}
        html,body{margin:0;padding:0}
        body{
            font-family:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            color:var(--ink-700);
            /* Keep the site-wide theme gradient */
            background: linear-gradient(135deg,var(--nav-left),var(--nav-mid) 50%,var(--nav-right) 100%);
            background-attachment: fixed;
            overflow-x:hidden;
        }

        /* ===== Cart SECTION with background image + overlay (Razor strict) ===== */
        .cart-section{
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            margin-right: calc(-50vw + 50%);
            padding: 24px 0 36px;
            min-height: 100vh;
            position: relative;
        }
        .cart-section::after{
            content:"";
            position:absolute; left:0; right:0; bottom:0; height:2px;
            background: linear-gradient(90deg, transparent 0 6%, var(--nav-line) 20% 80%, transparent 94% 100%);
            opacity:.9; pointer-events:none;
        }

        /* ===== Page wrapper ===== */
        .page{max-width:1380px;margin:0 auto;padding:12px 16px 32px;animation:fadeIn .5s ease-out}
        .title{font-size:28px;font-weight:800;color:#fff;margin:0 0 6px;text-shadow:0 3px 14px rgba(0,0,0,.45)}
        .sub{color:var(--ink-500);margin:0 0 18px}

        /* ===== Layout: 3 item columns + summary ===== */
        .cart-grid{display:grid;grid-template-columns:3fr 1fr;gap:20px}
        .items-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px}

        /* ===== Compact product card (vertical) ===== */
        .card{
            position:relative;background:linear-gradient(180deg,var(--card-bg),rgba(12,11,23,.55));
            border:1px solid var(--card-stroke);border-radius:14px;box-shadow:var(--shadow-1);
            backdrop-filter:blur(8px);overflow:hidden;padding:12px;display:flex;flex-direction:column;gap:8px;
            transition:transform .25s ease, box-shadow .25s ease, border-color .25s ease, filter .25s ease;
        }
        .card::before{content:"";position:absolute;left:0;right:0;top:0;height:3px;background:linear-gradient(90deg,#0C0B17,#3C2E8F);opacity:.95}
        .card:hover{transform:translateY(-6px);box-shadow:var(--shadow-1-hover);border-color:rgba(111,99,214,.55);filter:saturate(108%)}

        .thumb{width:100%;height:116px;border-radius:10px;overflow:hidden;background:linear-gradient(180deg,rgba(111,99,214,.18),rgba(60,46,143,.18));border-bottom:3px solid rgba(111,99,214,.55)}
        .thumb img{width:100%;height:100%;object-fit:cover;display:block}

        .name{font-size:14px;font-weight:700;color:var(--ink-100)}
        .meta{font-size:11px;color:var(--ink-500)}
        .price{font-size:16px;font-weight:800;color:#C9C6F5}

        .qty-form{display:flex;justify-content:center;align-items:center;gap:6px;padding:6px 8px;border-radius:10px;background:rgba(255,255,255,.06);border:1px solid var(--card-stroke)}
        .qty-btn{width:26px;height:26px;border:none;border-radius:7px;cursor:pointer;background:linear-gradient(180deg,var(--cta-1),var(--cta-2));color:#fff;font-weight:800;font-size:15px;box-shadow:0 6px 14px rgba(0,0,0,.35)}
        .qty-btn:hover{filter:brightness(1.06)}
        .qty-val{min-width:18px;text-align:center;font-weight:800;color:var(--ink-100);font-size:13px}

        .subp{font-size:11px;color:var(--ink-500);text-align:center}
        .remove-form{margin-top:2px}
        .remove-btn{width:100%;padding:6px 8px;border-radius:10px;background:transparent;border:1px solid var(--card-stroke);color:var(--ink-500);cursor:pointer;font-weight:700;font-size:12px}
        .remove-btn:hover{background:rgba(111,99,214,.22);color:#fff}

        .summary{position:sticky;top:16px;height:fit-content;background:linear-gradient(180deg,var(--card-bg),rgba(12,11,23,.55));border:1px solid var(--card-stroke);border-radius:16px;padding:16px;box-shadow:var(--shadow-1);backdrop-filter:blur(8px)}
        .summary::before{content:"";position:absolute;left:0;right:0;top:0;height:3px;background:linear-gradient(90deg,#0C0B17,#3C2E8F);opacity:.95}
        .summary-title{font-size:18px;font-weight:800;color:#fff;margin:0 0 10px}
        .row{display:flex;justify-content:space-between;padding:8px 0;border-bottom:1px dashed var(--border-lite);color:var(--ink-500)}
        .row:last-child{border-bottom:none}
        .total{display:flex;justify-content:space-between;font-size:20px;font-weight:900;margin-top:12px;color:#DDE1FF}
        .checkout-btn{width:100%;margin-top:12px;padding:12px;border:none;border-radius:12px;background:linear-gradient(180deg,var(--cta-1),var(--cta-2));color:var(--ink-100);font-weight:800;cursor:pointer;box-shadow:0 8px 20px rgba(0,0,0,.45)}
        .checkout-btn:hover{filter:brightness(1.06)}

        @@keyframes fadeIn{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}

        /* Responsive breakpoints */
        @@media (max-width:1199px){.cart-grid{grid-template-columns:2fr 1fr}.items-grid{grid-template-columns:repeat(2,1fr)}}
        @@media (max-width:992px){.cart-grid{grid-template-columns:1fr}.summary{position:static;margin-top:12px}.items-grid{grid-template-columns:repeat(2,1fr)}}
        @@media (max-width:700px){.items-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <!-- Background image applied to this section using Razor-resolved URL -->
    <section class="cart-section"
             style="background:
                        linear-gradient(135deg, rgba(12,11,23,.65),
                                              rgba(27,21,56,.62) 55%,
                                              rgba(60,46,143,.58)),
                        url('@cartBg') center / cover no-repeat fixed;">
        <div class="page">
            <h1 class="title">Shopping Cart</h1>
            <p class="sub">Review items and adjust quantities before checkout.</p>

            @if (!Model.CartItems.Any())
            {
                <p style="color:#fff">Your cart is empty.</p>
            }
            else
            {
                 var total = Model.CartItems.Sum(item =>
                        item.Quantity * (Model.ProductsInCart.FirstOrDefault(p => p.ProductId == item.ProductId)?.UnitCost ?? 0)
                    );
                    var count = Model.CartItems.Sum(x => x.Quantity);
             
                <div class="cart-grid">
                    <!-- LEFT: compact vertical cards (3 / row on laptop) -->
                    <div class="items-grid">
                        @foreach (var cartItem in Model.CartItems)
                        {
                            var product = Model.ProductsInCart.FirstOrDefault(p => p.ProductId == cartItem.ProductId);
                            var price = product?.UnitCost ?? 0;
                            var subtotal = cartItem.Quantity * price;

                            <article class="card">
                                <div class="thumb">
                                    <img src="https://placehold.co/480x320/9B93FF/FFFFFF?text=IMG"
                                         alt="@product?.ModelName" loading="lazy" />
                                </div>

                                <div class="name">@product?.ModelName</div>
                                <div class="meta">ID: @product?.ProductId</div>
                                <div class="price">$@price</div>

                                <form asp-controller="ShoppingCart" asp-action="UpdateCart" method="post" class="qty-form" aria-label="Quantity controls">
                                    <input type="hidden" name="cartItemId" value="@cartItem.RecordId" />
                                    <button type="submit" name="operation" value="decrease" class="qty-btn" aria-label="Decrease">−</button>
                                    <span class="qty-val" aria-live="polite">@cartItem.Quantity</span>
                                    <button type="submit" name="operation" value="increase" class="qty-btn" aria-label="Increase">+</button>
                                </form>

                                <div class="subp">Subtotal: $@subtotal</div>

                                <form asp-controller="ShoppingCart" asp-action="RemoveFromCart" method="post" class="remove-form">
                                    <input type="hidden" name="cartItemId" value="@cartItem.RecordId" />
                                    <button type="submit" class="remove-btn" aria-label="Remove item">Remove</button>
                                </form>
                            </article>
                        }
                    </div>

                    <!-- RIGHT: glass summary -->
                    <aside class="summary">
                        <div class="summary-title">Order Summary</div>
                        <div class="row"><span>Items</span><span>@count</span></div>
                        <div class="total"><span>Total</span><span>$@total</span></div>

                        <form asp-controller="ShoppingCart" asp-action="Checkout" method="post">
                            <button type="submit" class="checkout-btn">Proceed to Checkout</button>
                        </form>
                    </aside>
                </div>
            }
        </div>
    </section>
</body>
</html>