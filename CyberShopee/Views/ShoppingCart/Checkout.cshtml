@using Newtonsoft.Json
@model CyberShopee.ViewModels.Checkout.CheckoutViewModel
@{
    var serializedModel = JsonConvert.SerializeObject(Model);
    // Reuse the same background image used by the cart
    var checkoutBg = Url.Content("/images/shopping%20cart.png");
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>Checkout</title>

    <style>
        /* ===== Match Cart UI Theme ===== */
        @@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700&display=swap');

        :root{
            --nav-left:#0C0B17;
            --nav-mid:#1B1538;
            --nav-right:#3C2E8F;
            --nav-line:#6F63D6;

            --ink-100:#EDEBFF;
            --ink-300:#C9C6F5;
            --ink-500:#9CA3C7;
            --ink-700:#DDE1FF;

            --card-bg:rgba(20,18,40,0.65);
            --card-stroke:rgba(111,99,214,0.35);

            --cta-1:#6F63D6;
            --cta-2:#4C3FBA;

            --shadow-1:0 12px 28px rgba(0,0,0,.35);
            --shadow-1-hover:0 18px 36px rgba(0,0,0,.45);
            --border-lite:#C8C6FF;
        }

        *{box-sizing:border-box}
        html,body{margin:0;padding:0}
        body{
            font-family:'Plus Jakarta Sans',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
            color:var(--ink-700);
            background: linear-gradient(135deg,var(--nav-left),var(--nav-mid) 50%,var(--nav-right) 100%);
            background-attachment: fixed;
            overflow-x:hidden;
        }

        /* ===== Checkout SECTION (same pattern as cart-section) ===== */
        .checkout-section{
            width: 100vw;
            margin-left: calc(-50vw + 50%);
            margin-right: calc(-50vw + 50%);
            padding: 24px 0 36px;
            min-height: 100vh;
            position: relative;
            background:
                linear-gradient(135deg, rgba(12,11,23,.65),
                                      rgba(27,21,56,.62) 55%,
                                      rgba(60,46,143,.58)),
                url('@checkoutBg') center / cover no-repeat fixed;
        }
        .checkout-section::after{
            content:"";
            position:absolute; left:0; right:0; bottom:0; height:2px;
            background: linear-gradient(90deg, transparent 0 6%, var(--nav-line) 20% 80%, transparent 94% 100%);
            opacity:.9; pointer-events:none;
        }

        /* ===== Page wrapper ===== */
        .page{max-width:1380px;margin:0 auto;padding:12px 16px 32px;animation:fadeIn .5s ease-out}
        .title{font-size:28px;font-weight:800;color:#fff;margin:0 0 6px;text-shadow:0 3px 14px rgba(0,0,0,.45)}
        .sub{color:var(--ink-500);margin:0 0 18px}

        /* ===== Order summary glass card ===== */
        .summary{
            position:relative;
            background:linear-gradient(180deg,var(--card-bg),rgba(12,11,23,.55));
            border:1px solid var(--card-stroke);
            border-radius:16px;
            padding:16px;
            box-shadow:var(--shadow-1);
            backdrop-filter:blur(8px);
            overflow:hidden;
        }
        .summary::before{
            content:"";
            position:absolute;left:0;right:0;top:0;height:3px;
            background:linear-gradient(90deg,#0C0B17,#3C2E8F);
            opacity:.95
        }
        .summary-title{font-size:18px;font-weight:800;color:#fff;margin:0 0 10px}

        /* ===== Table styling to match theme ===== */
        .table{
            width:100%;
            border-collapse:collapse;
            border-spacing:0;
            color:var(--ink-300);
            font-size:14px;
        }
        .table thead th{
            text-align:left;
            padding:12px 8px;
            color:var(--ink-100);
            font-weight:700;
            border-bottom:1px solid rgba(200,198,255,.25);
        }
        .table tbody td{
            padding:12px 8px;
            border-bottom:1px dashed rgba(200,198,255,.25);
        }
        .table tbody tr:hover{
            background:rgba(255,255,255,.045);
        }
        .price{color:#C9C6F5;font-weight:800}

        .total-section{
            display:flex;
            justify-content:space-between;
            align-items:center;
            font-size:20px;
            font-weight:900;
            margin-top:12px;
            color:#DDE1FF;
            padding-top:10px;
            border-top:1px dashed var(--border-lite);
        }

        .place-btn{
            width:100%;
            margin-top:12px;
            padding:12px;
            border:none;
            border-radius:12px;
            background:linear-gradient(180deg,var(--cta-1),var(--cta-2));
            color:var(--ink-100);
            font-weight:800;
            cursor:pointer;
            box-shadow:0 8px 20px rgba(0,0,0,.45);
        }
        .place-btn:hover{filter:brightness(1.06)}

        @@keyframes fadeIn{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}

        /* Responsive (optional here, table is one column) */
        @@media (max-width:700px){
            .table thead{display:none}
            .table tbody tr{display:grid;grid-template-columns:1fr 1fr;gap:4px;padding:10px 0}
            .table tbody td{border-bottom:none}
        }
    </style>
</head>
<body>
<section class="checkout-section">
    <div class="page">
        <h1 class="title">Checkout</h1>
        <p class="sub">Review and confirm your order before placing it.</p>

        <div class="summary">
            <div class="summary-title">Order Summary</div>

            <table class="table" aria-label="Order summary table">
                <thead>
                    <tr>
                        <th>Product ID</th>
                        <th>Model</th>
                        <th>Quantity</th>
                        <th>Price</th>
                        <th>Sub-total</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var cartItem in Model.CartItems)
                    {
                        var product = Model.ProductsInCart.FirstOrDefault(p => p.ProductId == cartItem.ProductId);
                        <tr>
                            <td>@product?.ProductId</td>
                            <td>@product?.ModelName</td>
                            <td>@cartItem.Quantity</td>
                            <td class="price">$@product?.UnitCost</td>
                            <td class="price">$@(cartItem.Quantity * product?.UnitCost)</td>
                        </tr>
                    }
                </tbody>
            </table>

            <div class="total-section">
                <span>Total</span>
                <span>
                    $@Model.CartItems.Sum(item =>
                        item.Quantity * (Model.ProductsInCart.FirstOrDefault(p => p.ProductId == item.ProductId)?.UnitCost ?? 0))
                </span>
            </div>

            <!-- Keep same action/controller and payload; UI only -->
            <form asp-action="FinalizeOrder" asp-controller="ShoppingCart" method="post">
                <input type="hidden" name="customerId" value="@Context.Session.GetInt32("CustomerId")" />
                <input type="hidden" name="cart" value='@Html.Raw(serializedModel)' />
                <button type="submit" class="place-btn">Place Order</button>
            </form>
        </div>
    </div>
</section>
</body>
</html>